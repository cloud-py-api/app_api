<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Corporate Proxy - Permanent Settings for PHP CLI &mdash; AppAPI latest documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=4c969af8" />
      <link rel="stylesheet" type="text/css" href="../_static/css/styles.css?v=92f2225a" />
      <link rel="stylesheet" type="text/css" href="../_static/css/dark.css?v=41caee7b" />
      <link rel="stylesheet" type="text/css" href="../_static/css/light.css?v=c3d70dd7" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=c6e86fd7"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script src="../_static/tabs.js?v=3ee01567"></script>
        <script src="../_static/js/script.js?v=783f4f19"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Troubleshooting" href="Troubleshooting.html" />
    <link rel="prev" title="Scaling" href="Scaling.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            AppAPI
              <img src="../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../DeployConfigurations.html">Deployment configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CreationOfDeployDaemon.html">Creation of Deploy Daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../TestDeploy.html">Test Deploy Daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ManagingExternalApplications.html">Managing External Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tech_details/index.html">Technical details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../DevSetup.html">Setting up dev environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes_for_developers/index.html">Notes for Developers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Frequently Asked Questions</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="DockerContainerRegistry.html">Docker Container Registry</a></li>
<li class="toctree-l2"><a class="reference internal" href="DockerSocketProxy.html">Docker Socket Proxy</a></li>
<li class="toctree-l2"><a class="reference internal" href="GpuSupport.html">GPU support</a></li>
<li class="toctree-l2"><a class="reference internal" href="Scaling.html">Scaling</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Corporate Proxy - Permanent Settings for PHP CLI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#symptoms">Symptoms</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cause">Cause</a></li>
<li class="toctree-l3"><a class="reference internal" href="#permanent-solution">Permanent Solution</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#method-1-edit-php-cli-php-ini-file">Method 1: Edit PHP CLI <cite>php.ini</cite> File</a></li>
<li class="toctree-l4"><a class="reference internal" href="#method-2-set-system-wide-environment-variables">Method 2: Set System-Wide Environment Variables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#contact-support">Contact Support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Troubleshooting.html">Troubleshooting</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AppAPI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Frequently Asked Questions</a></li>
      <li class="breadcrumb-item active">Corporate Proxy - Permanent Settings for PHP CLI</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/faq/BehindCompanyProxy.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="corporate-proxy-permanent-settings-for-php-cli">
<h1>Corporate Proxy - Permanent Settings for PHP CLI<a class="headerlink" href="#corporate-proxy-permanent-settings-for-php-cli" title="Link to this heading"></a></h1>
<p>If you’re using our application within a corporate network that requires proxy settings, you might encounter issues when running PHP CLI commands that attempt to access the internet.</p>
<p>To resolve this, you need to configure permanent proxy settings for the PHP CLI environment.</p>
<section id="symptoms">
<h2>Symptoms<a class="headerlink" href="#symptoms" title="Link to this heading"></a></h2>
<p>When running the command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>php<span class="w"> </span>occ<span class="w"> </span>app_api:app:register<span class="w"> </span>--force-scopes<span class="w"> </span>test-deploy<span class="w"> </span>docker_socket_proxy<span class="w"> </span>--info-xml<span class="w"> </span>https://raw.githubusercontent.com/cloud-py-api/test-deploy/main/appinfo/info.xml<span class="w"> </span>--test-deploy-mode<span class="w"> </span>--no-ansi<span class="w"> </span>--no-warnings
</pre></div>
</div>
<p>You may receive an error similar to:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>file_get_contents(https://raw.githubusercontent.com/cloud-py-api/test-deploy/main/appinfo/info.xml): Failed to open stream: Connection timed out at /var/www/html/custom_apps/app_api/lib/Service/ExAppService.php#277
</pre></div>
</div>
</section>
<section id="cause">
<h2>Cause<a class="headerlink" href="#cause" title="Link to this heading"></a></h2>
<p>This issue occurs because the PHP CLI environment does not have the proxy settings configured, unlike the web PHP environment which may already be using proxy settings specified in your web server configuration.</p>
</section>
<section id="permanent-solution">
<h2>Permanent Solution<a class="headerlink" href="#permanent-solution" title="Link to this heading"></a></h2>
<p>To permanently configure proxy settings for PHP CLI, you can either modify the PHP CLI <cite>php.ini</cite> file or set environment variables system-wide.</p>
<section id="method-1-edit-php-cli-php-ini-file">
<h3>Method 1: Edit PHP CLI <cite>php.ini</cite> File<a class="headerlink" href="#method-1-edit-php-cli-php-ini-file" title="Link to this heading"></a></h3>
<ol class="arabic">
<li><p><strong>Locate the PHP CLI `php.ini` File</strong></p>
<p>Run the following command to find the loaded configuration file for PHP CLI:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>php<span class="w"> </span>--ini
</pre></div>
</div>
<p>Look for the line:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Loaded Configuration File: /path/to/php.ini
</pre></div>
</div>
</li>
<li><p><strong>Edit the `php.ini` File</strong></p>
<p>Open the <cite>php.ini</cite> file in a text editor with appropriate permissions:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>nano<span class="w"> </span>/path/to/php.ini
</pre></div>
</div>
</li>
<li><p><strong>Add Proxy Settings</strong></p>
<p>Add the following lines to configure the proxy settings:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[HTTP]</span>
<span class="c1">; Proxy settings for HTTP</span>
<span class="na">http.proxy_host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;proxy.example.com&quot;</span>
<span class="na">http.proxy_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">8080</span>
<span class="na">http.proxy_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;username&quot;</span>
<span class="na">http.proxy_password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;password&quot;</span>

<span class="k">[HTTPS]</span>
<span class="c1">; Proxy settings for HTTPS</span>
<span class="na">https.proxy_host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;proxy.example.com&quot;</span>
<span class="na">https.proxy_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">8080</span>
<span class="na">https.proxy_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;username&quot;</span>
<span class="na">https.proxy_password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;password&quot;</span>
</pre></div>
</div>
<p>Replace the placeholders with your actual proxy server details:</p>
<ul class="simple">
<li><p><cite>proxy.example.com</cite>: Your proxy server address.</p></li>
<li><p><cite>8080</cite>: Your proxy server port.</p></li>
<li><p><cite>username</cite>: Your proxy username (if required).</p></li>
<li><p><cite>password</cite>: Your proxy password (if required).</p></li>
</ul>
</li>
<li><p><strong>Save and Close the File</strong></p>
<p>Save the changes and exit the text editor.</p>
</li>
<li><p><strong>Verify the Configuration</strong></p>
<p>Run the PHP CLI command again:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>php<span class="w"> </span>occ<span class="w"> </span>app_api:app:register
</pre></div>
</div>
<p>It should now be able to access the internet through the proxy.</p>
</li>
</ol>
<p><strong>Note:</strong> Not all PHP functions respect the proxy settings in <cite>php.ini</cite>. If issues persist, consider using system-wide environment variables.</p>
</section>
<section id="method-2-set-system-wide-environment-variables">
<h3>Method 2: Set System-Wide Environment Variables<a class="headerlink" href="#method-2-set-system-wide-environment-variables" title="Link to this heading"></a></h3>
<ol class="arabic">
<li><p><strong>Edit Shell Profile</strong></p>
<p>For a permanent solution, add the proxy settings to the system-wide environment variables. Open the <cite>/etc/environment</cite> file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>nano<span class="w"> </span>/etc/environment
</pre></div>
</div>
</li>
<li><p><strong>Add Proxy Environment Variables</strong></p>
<p>Add the following lines to the file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">http_proxy</span><span class="o">=</span><span class="s2">&quot;http://proxy.example.com:8080&quot;</span>
<span class="nv">https_proxy</span><span class="o">=</span><span class="s2">&quot;http://proxy.example.com:8080&quot;</span>

<span class="c1"># If your proxy requires authentication:</span>
<span class="nv">http_proxy</span><span class="o">=</span><span class="s2">&quot;http://username:password@proxy.example.com:8080&quot;</span>
<span class="nv">https_proxy</span><span class="o">=</span><span class="s2">&quot;http://username:password@proxy.example.com:8080&quot;</span>
</pre></div>
</div>
<p>Replace the placeholders with your actual proxy details.</p>
</li>
<li><p><strong>Apply the Changes</strong></p>
<p>Log out and log back in, or reboot the system to apply the changes.</p>
</li>
<li><p><strong>Verify the Configuration</strong></p>
<p>Run the command again:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>php<span class="w"> </span>occ<span class="w"> </span>app_api:app:register<span class="w"> </span>--force-scopes<span class="w"> </span>test-deploy<span class="w"> </span>docker_socket_proxy<span class="w"> </span>--info-xml<span class="w"> </span>https://raw.githubusercontent.com/cloud-py-api/test-deploy/main/appinfo/info.xml<span class="w"> </span>--test-deploy-mode<span class="w"> </span>--no-ansi<span class="w"> </span>--no-warnings
</pre></div>
</div>
<p>It should now work without connectivity issues.</p>
</li>
</ol>
<p><strong>Note:</strong> This method sets the proxy settings for all users and applications on the system.</p>
</section>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading"></a></h2>
<ul>
<li><p><strong>Incorrect Proxy Details</strong></p>
<p>Ensure all proxy details are correct. Incorrect hostnames, ports, or credentials will prevent connectivity.</p>
</li>
<li><p><strong>Environment Variables Not Loaded</strong></p>
<p>Make sure the environment variables are correctly loaded. A system reboot or re-login may be necessary.</p>
</li>
<li><p><strong>Firewall Restrictions</strong></p>
<p>Verify with your network administrator that your system is allowed to access the internet through the proxy.</p>
</li>
</ul>
</section>
<section id="contact-support">
<h2>Contact Support<a class="headerlink" href="#contact-support" title="Link to this heading"></a></h2>
<p>If you’ve followed these steps and still experience issues, please contact our support team for further assistance.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Scaling.html" class="btn btn-neutral float-left" title="Scaling" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Troubleshooting.html" class="btn btn-neutral float-right" title="Troubleshooting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024 Nextcloud GmbH.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>